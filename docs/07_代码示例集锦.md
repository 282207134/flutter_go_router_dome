# Go Router 代码示例集锦

本文档汇集了 go_router 在实际项目中的常用代码示例。

## 基础导航示例

### 简单跳转

```dart
// 方式 1：使用路径
ElevatedButton(
  onPressed: () => context.go('/home'),
  child: const Text('跳转到首页'),
)

// 方式 2：使用命名路由
ElevatedButton(
  onPressed: () => context.goNamed('home'),
  child: const Text('跳转到首页'),
)
```

### 压栈导航

```dart
// 压栈导航会保留当前页面，可以返回
ElevatedButton(
  onPressed: () => context.push('/details'),
  child: const Text('查看详情'),
)

// 使用命名路由
ElevatedButton(
  onPressed: () => context.pushNamed('details'),
  child: const Text('查看详情'),
)
```

### 替换当前页面

```dart
// 替换当前页面，无法返回
ElevatedButton(
  onPressed: () => context.replace('/login'),
  child: const Text('跳转到登录页'),
)
```

### 返回上一页

```dart
ElevatedButton(
  onPressed: () => context.pop(),
  child: const Text('返回'),
)

// 返回并携带数据
ElevatedButton(
  onPressed: () => context.pop('返回的结果'),
  child: const Text('返回并携带数据'),
)

// 接收返回的数据
final result = await context.push('/child-page');
if (result != null) {
  print('收到返回数据：$result');
}
```

## 参数传递示例

### 路径参数

```dart
// 路由定义
GoRoute(
  path: '/user/:userId/post/:postId',
  builder: (context, state) {
    final userId = state.pathParameters['userId']!;
    final postId = state.pathParameters['postId']!;
    return PostDetailPage(userId: userId, postId: postId);
  },
)

// 使用路径跳转
context.go('/user/123/post/456');

// 使用命名路由跳转
context.goNamed(
  'post-detail',
  pathParameters: {
    'userId': '123',
    'postId': '456',
  },
);
```

### 查询参数

```dart
// 路由定义（无需特殊处理）
GoRoute(
  path: '/search',
  builder: (context, state) {
    final keyword = state.uri.queryParameters['keyword'];
    final category = state.uri.queryParameters['category'];
    final page = int.tryParse(state.uri.queryParameters['page'] ?? '1') ?? 1;
    return SearchPage(keyword: keyword, category: category, page: page);
  },
)

// 使用路径跳转
context.go('/search?keyword=flutter&category=tutorial&page=2');

// 使用命名路由跳转
context.goNamed(
  'search',
  queryParameters: {
    'keyword': 'flutter',
    'category': 'tutorial',
    'page': '2',
  },
);
```

### Extra 参数

```dart
// 传递复杂对象
final user = User(id: 123, name: 'John');
context.push('/profile', extra: user);

// 接收复杂对象
GoRoute(
  path: '/profile',
  builder: (context, state) {
    final user = state.extra as User?;
    return ProfilePage(user: user);
  },
)
```

## 路由配置示例

### 基础路由配置

```dart
final router = GoRouter(
  initialLocation: '/home',
  debugLogDiagnostics: true,
  routes: [
    GoRoute(
      path: '/',
      redirect: (context, state) => '/home',
    ),
    GoRoute(
      path: '/home',
      name: 'home',
      builder: (context, state) => const HomePage(),
    ),
    GoRoute(
      path: '/settings',
      name: 'settings',
      builder: (context, state) => const SettingsPage(),
    ),
  ],
  errorBuilder: (context, state) => ErrorPage(error: state.error),
);
```

### 嵌套路由配置

```dart
GoRoute(
  path: '/dashboard',
  name: 'dashboard',
  builder: (context, state) => const DashboardPage(),
  routes: [
    GoRoute(
      path: 'overview',
      name: 'dashboard-overview',
      builder: (context, state) => const OverviewPage(),
    ),
    GoRoute(
      path: 'analytics',
      name: 'dashboard-analytics',
      builder: (context, state) => const AnalyticsPage(),
    ),
    GoRoute(
      path: 'reports/:reportId',
      name: 'dashboard-report',
      builder: (context, state) {
        final reportId = state.pathParameters['reportId']!;
        return ReportPage(reportId: reportId);
      },
    ),
  ],
)
```

### ShellRoute 示例

```dart
ShellRoute(
  builder: (context, state, child) {
    return Scaffold(
      appBar: AppBar(title: const Text('My App')),
      body: child,
      drawer: const NavigationDrawer(),
    );
  },
  routes: [
    GoRoute(
      path: '/home',
      builder: (context, state) => const HomePage(),
    ),
    GoRoute(
      path: '/profile',
      builder: (context, state) => const ProfilePage(),
    ),
  ],
)
```

### StatefulShellRoute 底部导航

```dart
StatefulShellRoute.indexedStack(
  builder: (context, state, navigationShell) {
    return Scaffold(
      body: navigationShell,
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: navigationShell.currentIndex,
        onTap: (index) => navigationShell.goBranch(index),
        items: const [
          BottomNavigationBarItem(icon: Icon(Icons.home), label: 'Home'),
          BottomNavigationBarItem(icon: Icon(Icons.search), label: 'Search'),
          BottomNavigationBarItem(icon: Icon(Icons.person), label: 'Profile'),
        ],
      ),
    );
  },
  branches: [
    StatefulShellBranch(
      routes: [
        GoRoute(
          path: '/home',
          builder: (context, state) => const HomePage(),
        ),
      ],
    ),
    StatefulShellBranch(
      routes: [
        GoRoute(
          path: '/search',
          builder: (context, state) => const SearchPage(),
        ),
      ],
    ),
    StatefulShellBranch(
      routes: [
        GoRoute(
          path: '/profile',
          builder: (context, state) => const ProfilePage(),
        ),
      ],
    ),
  ],
)
```

## 路由守卫示例

### 全局登录守卫

```dart
class AuthState extends ChangeNotifier {
  bool _isLoggedIn = false;
  
  bool get isLoggedIn => _isLoggedIn;
  
  void login() {
    _isLoggedIn = true;
    notifyListeners();
  }
  
  void logout() {
    _isLoggedIn = false;
    notifyListeners();
  }
}

final authState = AuthState();

final router = GoRouter(
  refreshListenable: authState,
  redirect: (context, state) {
    final isLoggedIn = authState.isLoggedIn;
    final isLoggingIn = state.matchedLocation == '/login';
    
    // 如果未登录且不在登录页，跳转到登录页
    if (!isLoggedIn && !isLoggingIn) {
      return '/login';
    }
    
    // 如果已登录且在登录页，跳转到首页
    if (isLoggedIn && isLoggingIn) {
      return '/home';
    }
    
    return null; // 不重定向
  },
  routes: [...],
);
```

### 路由级别权限守卫

```dart
GoRoute(
  path: '/admin',
  name: 'admin',
  builder: (context, state) => const AdminPage(),
  redirect: (context, state) {
    final user = getCurrentUser();
    
    if (user == null) {
      return '/login?from=${Uri.encodeComponent(state.uri.toString())}';
    }
    
    if (!user.isAdmin) {
      return '/unauthorized';
    }
    
    return null; // 允许访问
  },
)
```

### 多条件守卫

```dart
redirect: (context, state) {
  final isLoggedIn = authState.isLoggedIn;
  final hasCompletedOnboarding = prefs.getBool('onboarding_completed') ?? false;
  final location = state.matchedLocation;
  
  // 优先级 1：未完成引导，跳转到引导页
  if (!hasCompletedOnboarding && location != '/onboarding') {
    return '/onboarding';
  }
  
  // 优先级 2：未登录，跳转到登录页
  if (!isLoggedIn && location != '/login') {
    return '/login';
  }
  
  // 优先级 3：需要验证邮箱
  if (isLoggedIn && !user.emailVerified && location != '/verify-email') {
    return '/verify-email';
  }
  
  return null;
}
```

## 自定义转场动画

### 淡入淡出

```dart
GoRoute(
  path: '/fade',
  pageBuilder: (context, state) => CustomTransitionPage(
    key: state.pageKey,
    child: const FadePage(),
    transitionsBuilder: (context, animation, secondaryAnimation, child) {
      return FadeTransition(
        opacity: animation,
        child: child,
      );
    },
  ),
)
```

### 滑动进入

```dart
GoRoute(
  path: '/slide',
  pageBuilder: (context, state) => CustomTransitionPage(
    key: state.pageKey,
    child: const SlidePage(),
    transitionsBuilder: (context, animation, secondaryAnimation, child) {
      const begin = Offset(1.0, 0.0);
      const end = Offset.zero;
      const curve = Curves.easeInOut;
      
      var tween = Tween(begin: begin, end: end).chain(
        CurveTween(curve: curve),
      );
      
      return SlideTransition(
        position: animation.drive(tween),
        child: child,
      );
    },
  ),
)
```

### 缩放动画

```dart
GoRoute(
  path: '/scale',
  pageBuilder: (context, state) => CustomTransitionPage(
    key: state.pageKey,
    child: const ScalePage(),
    transitionsBuilder: (context, animation, secondaryAnimation, child) {
      return ScaleTransition(
        scale: CurvedAnimation(
          parent: animation,
          curve: Curves.easeInOut,
        ),
        child: child,
      );
    },
  ),
)
```

### 旋转动画

```dart
GoRoute(
  path: '/rotate',
  pageBuilder: (context, state) => CustomTransitionPage(
    key: state.pageKey,
    child: const RotatePage(),
    transitionsBuilder: (context, animation, secondaryAnimation, child) {
      return RotationTransition(
        turns: animation,
        child: child,
      );
    },
  ),
)
```

### 对话框样式

```dart
GoRoute(
  path: '/dialog',
  pageBuilder: (context, state) => CustomTransitionPage(
    key: state.pageKey,
    opaque: false,
    barrierDismissible: true,
    barrierColor: Colors.black54,
    transitionsBuilder: (context, animation, secondaryAnimation, child) {
      return FadeTransition(
        opacity: animation,
        child: child,
      );
    },
    child: Center(
      child: Material(
        elevation: 8,
        borderRadius: BorderRadius.circular(12),
        child: Container(
          width: 300,
          padding: const EdgeInsets.all(24),
          child: const DialogContent(),
        ),
      ),
    ),
  ),
)
```

## 实用工具函数

### 路由监听器

```dart
class MyRouteObserver extends NavigatorObserver {
  @override
  void didPush(Route route, Route? previousRoute) {
    print('Push: ${route.settings.name}');
  }
  
  @override
  void didPop(Route route, Route? previousRoute) {
    print('Pop: ${route.settings.name}');
  }
}

// 使用
final router = GoRouter(
  observers: [MyRouteObserver()],
  routes: [...],
);
```

### 获取当前路由信息

```dart
// 方法 1：使用 context
final location = GoRouterState.of(context).uri.toString();
final pathParams = GoRouterState.of(context).pathParameters;
final queryParams = GoRouterState.of(context).uri.queryParameters;

// 方法 2：使用 GoRouter 实例
final router = GoRouter.of(context);
final location = router.routerDelegate.currentConfiguration.uri.toString();
```

### 判断是否可以返回

```dart
if (context.canPop()) {
  context.pop();
} else {
  // 已经是根路由，执行其他操作
  context.go('/home');
}
```

### 路由辅助类

```dart
class AppRoutes {
  static const home = '/home';
  static const profile = '/profile';
  static const settings = '/settings';
  
  static String userDetail(String userId) => '/user/$userId';
  static String postDetail(String userId, String postId) =>
      '/user/$userId/post/$postId';
}

// 使用
context.go(AppRoutes.home);
context.go(AppRoutes.userDetail('123'));
context.go(AppRoutes.postDetail('123', '456'));
```

## 总结

以上示例涵盖了 go_router 的常见使用场景。在实际项目中，可以根据需求组合使用这些模式。建议：

1. **保持路由配置简洁**：将复杂逻辑放在页面组件中
2. **使用命名路由**：便于重构和维护
3. **集中管理路由常量**：避免硬编码路径字符串
4. **合理使用守卫**：在适当的层级进行权限控制
5. **善用转场动画**：提升用户体验
