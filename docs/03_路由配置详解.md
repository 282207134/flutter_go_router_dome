# 路由配置详解

## GoRoute 参数说明

### 基础参数

```dart
GoRoute(
  // 路径：定义 URL 路径
  path: '/user/:id',
  
  // 名称：可选，用于命名路由，便于通过名称导航
  name: 'user-detail',
  
  // 构建器：构建页面 Widget
  builder: (context, state) => UserDetailPage(
    userId: state.pathParameters['id']!,
  ),
  
  // 页面构建器：返回 Page 对象，可自定义转场动画
  pageBuilder: (context, state) => MaterialPage(
    key: state.pageKey,
    child: UserDetailPage(userId: state.pathParameters['id']!),
  ),
  
  // 子路由
  routes: [
    GoRoute(
      path: 'edit',  // 完整路径为 /user/:id/edit
      builder: (context, state) => UserEditPage(),
    ),
  ],
  
  // 重定向函数
  redirect: (context, state) {
    // 如果用户未登录，重定向到登录页
    if (!isLoggedIn) {
      return '/login';
    }
    return null; // 返回 null 表示不重定向
  },
)
```

## 路径定义规则

### 1. 静态路径

```dart
GoRoute(path: '/home')          // 匹配 /home
GoRoute(path: '/settings')      // 匹配 /settings
```

### 2. 动态路径参数

```dart
GoRoute(path: '/user/:id')              // 匹配 /user/123
GoRoute(path: '/post/:postId/comment/:commentId')  // 多个参数
```

访问参数：

```dart
final userId = state.pathParameters['id'];
```

### 3. 查询参数

URL 示例：`/search?keyword=flutter&category=tutorial`

访问查询参数：

```dart
final keyword = state.uri.queryParameters['keyword'];
final category = state.uri.queryParameters['category'];
```

### 4. 嵌套路由

```dart
GoRoute(
  path: '/dashboard',
  builder: (context, state) => DashboardPage(),
  routes: [
    GoRoute(
      path: 'overview',    // 完整路径：/dashboard/overview
      builder: (context, state) => OverviewPage(),
    ),
    GoRoute(
      path: 'analytics',   // 完整路径：/dashboard/analytics
      builder: (context, state) => AnalyticsPage(),
    ),
  ],
)
```

## GoRouterState 详解

`GoRouterState` 对象包含当前路由的所有信息：

```dart
class MyPage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // 假设路由为：/user/123?tab=posts#section1
    
    // 获取路径参数
    state.pathParameters['id'];  // "123"
    
    // 获取查询参数
    state.uri.queryParameters['tab'];  // "posts"
    
    // 获取完整 URI
    state.uri;  // Uri 对象
    
    // 获取当前位置
    state.location;  // "/user/123?tab=posts"
    
    // 获取匹配的路径（不含查询参数）
    state.matchedLocation;  // "/user/123"
    
    // 获取路由名称
    state.name;  // 如果定义了 name 属性
    
    // 获取完整路径
    state.fullPath;  // "/user/123"
    
    // 获取 extra 参数
    state.extra;  // 通过 context.go('/path', extra: data) 传递的数据
    
    // 获取页面 key
    state.pageKey;  // ValueKey
    
    return Container();
  }
}
```

## 自定义转场动画

使用 `pageBuilder` 替代 `builder`：

```dart
GoRoute(
  path: '/fade',
  pageBuilder: (context, state) => CustomTransitionPage(
    key: state.pageKey,
    child: FadePage(),
    transitionsBuilder: (context, animation, secondaryAnimation, child) {
      return FadeTransition(
        opacity: animation,
        child: child,
      );
    },
  ),
)
```

常见转场动画示例：

### 淡入淡出

```dart
transitionsBuilder: (context, animation, secondaryAnimation, child) {
  return FadeTransition(opacity: animation, child: child);
}
```

### 滑动

```dart
transitionsBuilder: (context, animation, secondaryAnimation, child) {
  return SlideTransition(
    position: animation.drive(
      Tween(begin: const Offset(1, 0), end: Offset.zero)
        .chain(CurveTween(curve: Curves.easeInOut)),
    ),
    child: child,
  );
}
```

### 缩放

```dart
transitionsBuilder: (context, animation, secondaryAnimation, child) {
  return ScaleTransition(scale: animation, child: child);
}
```

## 重定向 (Redirect)

### 全局重定向

```dart
final router = GoRouter(
  redirect: (context, state) {
    final isLoggedIn = // 检查登录状态
    final isLoggingIn = state.matchedLocation == '/login';
    
    if (!isLoggedIn && !isLoggingIn) {
      return '/login';
    }
    if (isLoggedIn && isLoggingIn) {
      return '/home';
    }
    return null;
  },
  routes: [...],
);
```

### 路由级别重定向

```dart
GoRoute(
  path: '/admin',
  redirect: (context, state) {
    if (!isAdmin) {
      return '/unauthorized';
    }
    return null;
  },
  builder: (context, state) => AdminPage(),
)
```

## 最佳实践

1. **使用命名路由**：对常用路由定义名称，方便维护
2. **集中管理路由**：将路由配置集中在一个文件中
3. **类型安全**：使用 Dart 3 的类型特性确保参数安全
4. **错误处理**：定义全局的错误页面
5. **懒加载**：对大型页面使用懒加载优化性能
